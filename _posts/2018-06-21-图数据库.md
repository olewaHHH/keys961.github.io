---
layout: post
title: "图数据库"
author: "keys961"
comments: true
typora-root-url: ./
---

该文档记录《图数据库》读书笔记

## Chapter 1 & 2

1. 图数据库中，联系（即“有向边”）为一等公民
2. 带标签的属性图模型
   - 由节点、联系（即有向边）、属性、标签组成
   - 节点可有：
     - 标识符：ID，在数据库中可不唯一
     - 标签：可以有多个，表明节点的角色
     - 属性：键值对
   - 联系（有向边）可有：
     - 方向
     - 标识符：ID，在数据库中可不唯一
     - 名字：表明联系的意义
     - 起始节点和终止节点
     - 属性：给图算法提供元数据，或者增加联系的额外语义

## Chapter 3

Cypher CQL（TODO: 高级特性需要通过后文补充）

1. `MATCH`

   类似SQL的`SELECT` ，匹配用，如：

   ```cypher
   MATCH (a:Person {name:'Jim'}) -[:KNOWS]-> (b) -[:KNOWS]-> (c), (a) -[:KNOWS]-> (c)
   RETURN b, c
   ```

   - 表明一个有指向的联系可用`-[relation-id:relation-name]->`或者`<-[relation-id:relation-name]-`表示，`relation-id`可省略
   - 无指向联系为`-[relation-id:relation-name]-`
   - 联系中表示长度可变：`-[relation-id:relation-name*low...up]-`/`-[relation-id:relation-name*low...up]->`（前者没规定方向，后者规定了方向）表示长度可变的路径，最小长度为`low`，最大为`up`
   - 联系中使用`|`表示“或”语义
   - `()`可表明一个匿名节点

2. `RETURN`，返回结果，最简单的查询是`MATCH & RETURN `字句，如上述样例

3. `WHERE`

   类似SQL的`WHERE`，可把上述样例改写为

   ```cypher
   MATCH (a:Person) -[:KNOWS]-> (b) -[:KNOWS]-> (c), (a) -[:KNOWS]-> (c)
   WHERE a.name = 'Jim'
   RETURN b, c
   ```

4. `CREATE`

   用于创建节点和联系，若单独使用，则永远会创建新节点/联系，下面是用已有的a节点，创建一个新节点b(有属性Ian)，并给2节点创建新联系

   ```cypher
   MATCH (a:Person {name:'Jim'}) 
   CREATE (a) -[:KNOWS]-> (b:Person {name:'Ian'}
   RETURN a, b
   ```

   若要通过已有节点和联系创建，需要搭配`MATCH`，如给以下2个已有节点创建联系，注意，**使用已有节点不需要对节点声明标签**：

   ```cypher
   MATCH (a:Person {name:'Ian'}),(b:Person {name:'Emil'}) 
   CREATE (a) -[:KNOWS]-> (b) 
   RETURN a, b
   ```

5. `MERGE`

   等效`MATCH + CREATE`。当查找时，若找到匹配断言的节点和联系，则复用，否则就直接创建。

   如，若没找到`School`节点，则创建时执行`SET`动作：

   ```cypher
   MERGE {m:School {name: 'ABC'}}
   ON CREATE
          SET m.address = 'AAA'
   RETURN m
   ```

   有如，若对于已有的2节点，若关系不存在，则创建联系时执行`SET`动作（这里`MATCH`不能省略，否则当联系不存在时，2个节点都会新创建出来，即匹配必须全部满足才行，否则全部用于创建新的）：

   ```cypher
   MATCH (m:School {name:'AAA'}), (p:Person {name:'PPP'})
   MERGE (p) -[r:ACTED_IN]->(m)
   ON CREATE 
         SET r.roles = ['teacher']
   RETURN p, r, m
   ```

6. `DELETE`:删除节点和联系，要和`MATCH`字句使用

   下例是删除属性`name`为`Jim`的`Person`节点所有的邻接节点和对应的联系

   ```cypher
   MATCH (a:Person) -[r]-> (b)
   WHERE a.name = 'Jim'
   DELETE r, b
   ```

7. `REMOVE`: 删除标签和属性，同`DELETE`用法

8. `SET`：设置节点/联系的属性值，常与`MATCH`字句配合使用

   如下所示，设置节点属性：

   ```cypher
   MATCH (a:Person {name:'Ian'})
   SET a.name = 'AAA'
   RETURN a
   ```

9. `SKIP`&`LIMIT`: 分页，分别对应`offset`和`count`

10. `UNION`: 取2个`MATCH`字句的并集，若加`ALL`则结果条目会有重复

11. `IN`：判断是否属于一个集合，格式: `IN [collections-of-value]`

12. `FOREACH`: 对列表每个元素执行更新操作

13. `WITH`：链式查询，类似SQL的`WITH`