---
layout: post
title: "DDIA-事务"
author: "keys961"
comments: true
catalog: true
tags:
  - Distributed System
typora-root-url: ./
---

本文大多说明的是单点下的事务，分布式场景较少涉及。

# 1. 理解事务

## 1.1. ACID

> BASE: 即基本可用性（Basically Avaliable），弱状态（Soft state），最终一致性（Eventual consistency）。其唯一确定的是“它不是ACID”，此外没承诺任何东西。

### 1.1.1. 原子性

一组操作要么全部执行完毕，要么完全没有执行。即：**出错时中止事务，将部分完成的内容回滚**。

### 1.1.2. 一致性

不同场景下，“一致性”意义不同：

- 数据复制时，引出副本的一致性（如最终一致性）
- 一致性散列指动态分区再配合的方法
- CAP中，一致性表示“线性化”（原子一致性/强一致性）
- ACID中，一致性指数据库处于**应用程序所期待的“预期状态”**

本质上，是要求应用层维护状态一致（或恒等），应用程序有责任正确地定义事务来保证一致性。可以说，C本身不源于数据库。

### 1.1.3. 隔离性

并发执行的多个事务相互隔离，不能相互交叉。虽然它们可能同时进行，但事务提交后，结果**必须和串行（一个接一个）执行相同**，即**可串行化**。

而现实中，很少使用串行化隔离级别（因为性能），而使用**弱隔离级别**，提供比串行化更弱的保证，后面会叙述。

### 1.1.4. 持久性

一旦事务提交成功，即使存在硬件故障/数据库崩溃，事务写入的数据不会丢失。

对于单节点，其意味着数据被写入非易失存储设备；对于支持远程复制的数据库，持久性意味数据已被成功复制到多个节点。

## 1.2. 单对象与多对象事务操作

